<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de inscrições e gestão do Projeto Zumba - SEMCAS São Luís">
    <meta name="theme-color" content="#ec4899">
    <title>Painel Zumba Admin Pro</title>
    
    <!-- Preconnects para Performance -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Font (Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Ícones (Lucide) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Bibliotecas de Exportação (Excel e PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>

    <style>
        /* ===========================================
           ESTILOS BASE E VARIÁVEIS CSS
           =========================================== */
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --secondary: #f3f4f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --border-color: #d1d5db;
            --radius: 0.375rem;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--secondary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ===========================================
           GRADIENTE E ELEMENTOS VISUAIS
           =========================================== */
        .zumba-gradient-text { 
            background: linear-gradient(135deg, #be185d 0%, #ec4899 100%); 
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent; 
            font-weight: 700;
        }

        /* ===========================================
           SISTEMA DE BOTÕES UNIFICADO
           =========================================== */
        .btn { 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            font-weight: 500;
            border-radius: var(--radius);
            transition: var(--transition);
            cursor: pointer;
            border: none;
            font-size: 0.875rem;
            white-space: nowrap;
            user-select: none;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary { 
            background-color: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        } 
        .btn-primary:hover:not(:disabled) { 
            background-color: var(--primary-dark);
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .btn-secondary { 
            background-color: white;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        } 
        .btn-secondary:hover:not(:disabled) { 
            background-color: #f9fafb;
            border-color: #9ca3af;
        }

        .btn-danger { 
            background-color: var(--danger);
            color: white;
        } 
        .btn-danger:hover:not(:disabled) { 
            background-color: #dc2626;
        }

        .btn-success { 
            background-color: var(--success);
            color: white;
        } 
        .btn-success:hover:not(:disabled) { 
            background-color: #059669;
        }
        
        .btn-whatsapp { 
            background-color: #25D366;
            color: white;
        }
        .btn-whatsapp:hover:not(:disabled) { 
            background-color: #128C7E;
        }

        /* ===========================================
           SISTEMA DE FORMULÁRIOS OTIMIZADO
           =========================================== */
        .form-input, .form-select { 
            width: 100%;
            padding: 0.625rem 0.875rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background-color: white;
            transition: var(--transition);
            text-transform: uppercase;
            color: var(--text-primary);
        }

        /* Exceções para uppercase */
        input[type="email"],
        input[type="password"],
        input[type="date"],
        input[type="number"] { 
            text-transform: none;
        }
        
        .form-input:focus,
        .form-select:focus { 
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
        }

        .form-input:read-only,
        .form-input[readonly] { 
            background-color: #f3f4f6;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .form-label { 
            display: block;
            margin-bottom: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .helper-text { 
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-style: italic;
        }

        /* ===========================================
           UTILITÁRIOS E ESTADOS
           =========================================== */
        .hidden-section { 
            display: none !important;
        }

        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===========================================
           MODAL SYSTEM
           =========================================== */
        .modal-overlay { 
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* ===========================================
           TABS DE NAVEGAÇÃO
           =========================================== */
        .nav-tab { 
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }
        
        .nav-tab:hover { 
            color: var(--primary);
            background-color: rgba(236, 72, 153, 0.05);
        } 
        
        .nav-tab.active { 
            color: var(--primary);
            border-bottom-color: var(--primary);
            background-color: rgba(236, 72, 153, 0.05);
        }

        /* ===========================================
           ACESSIBILIDADE E RESPONSIVE
           =========================================== */
        @media (max-width: 768px) {
            .btn {
                font-size: 0.8125rem;
                padding: 0.5rem 0.75rem;
            }

            .form-input, .form-select {
                font-size: 16px; /* Previne zoom no iOS */
            }

            .nav-tab {
                padding: 0.625rem 0.875rem;
                font-size: 0.875rem;
            }
        }

        /* Focus visible para acessibilidade */
        *:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* ===========================================
           CUSTOM SCROLLBAR
           =========================================== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* ===========================================
           CARDS E CONTAINERS
           =========================================== */
        .card {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        /* ===========================================
           BADGES E STATUS
           =========================================== */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
            white-space: nowrap;
        }

        .badge-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .badge-danger {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        /* ===========================================
           SKELETON LOADING
           =========================================== */
        .skeleton {
            background: linear-gradient(
                90deg,
                #f3f4f6 25%,
                #e5e7eb 50%,
                #f3f4f6 75%
            );
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* ===========================================
           PRINT STYLES
           =========================================== */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background: white;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body class="text-gray-900">

    <div class="min-h-screen flex flex-col">

        <!-- ===== SEÇÃO DE LOGIN ===== -->
        <section id="login-view" class="flex-grow flex items-center justify-center p-4 bg-gradient-to-br from-pink-50 to-purple-50">
            <div class="w-full max-w-md space-y-8">
                <div class="text-center">
                    <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 mb-4 shadow-lg">
                        <i data-lucide="music-2" class="w-10 h-10 text-white"></i>
                    </div>
                    <h1 class="text-4xl font-bold zumba-gradient-text tracking-tight">Projeto Zumba</h1>
                    <p class="mt-2 text-gray-600 text-lg font-medium">Área Administrativa e Inscrições</p>
                    <p class="mt-1 text-sm text-gray-500">SEMCAS - São Luís/MA</p>
                </div>
                
                <div class="card p-8">
                    <form id="admin-login-form" class="space-y-6">
                        <div class="border-b pb-3 mb-4">
                            <h2 class="text-lg font-semibold text-gray-800 flex items-center gap-2">
                                <i data-lucide="lock" class="w-5 h-5 text-pink-600"></i>
                                Acesso Restrito (Admin)
                            </h2>
                        </div>
                        
                        <div>
                            <label for="admin-email" class="form-label">Email de Administrador</label>
                            <input 
                                type="email" 
                                id="admin-email" 
                                class="form-input"
                                style="text-transform: none;"
                                placeholder="admin@exemplo.com"
                                required 
                                autocomplete="email"
                            >
                        </div>
                        
                        <div>
                            <label for="admin-password" class="form-label">Senha</label>
                            <input 
                                type="password" 
                                id="admin-password" 
                                class="form-input"
                                style="text-transform: none;"
                                placeholder="••••••••"
                                required 
                                autocomplete="current-password"
                            >
                        </div>
                        
                        <button type="submit" class="w-full btn btn-primary py-3 text-base font-semibold">
                            <i data-lucide="log-in" class="w-5 h-5 mr-2"></i>
                            Entrar no Painel
                        </button>
                    </form>
                    
                    <div class="mt-8">
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-300"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-3 bg-white text-gray-600 font-medium">Área do Participante</span>
                            </div>
                        </div>
                        
                        <button 
                            type="button" 
                            id="go-to-register-btn" 
                            class="mt-6 w-full btn btn-secondary font-bold text-pink-600 border-pink-200 hover:bg-pink-50 py-3 text-lg"
                        >
                            <i data-lucide="user-plus" class="w-5 h-5 mr-2"></i> 
                            Preencher Ficha de Inscrição
                        </button>
                    </div>
                    
                    <p id="auth-error" class="mt-4 text-sm text-center text-red-600 font-medium hidden-section"></p>
                </div>

                <div class="text-center text-xs text-gray-500">
                    <p>© 2025 SEMCAS - Prefeitura de São Luís</p>
                </div>
            </div>
        </section>

        <!-- ===== SEÇÃO DE CADASTRO (PÚBLICO) ===== -->
        <section id="register-view" class="hidden-section flex-grow bg-gray-50 py-8 px-4">
            <div class="max-w-4xl mx-auto card overflow-hidden">
                <!-- Header Fixo -->
                <div class="p-6 bg-white border-b border-gray-200 flex justify-between items-center sticky top-0 z-20 shadow-sm">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800" id="form-title">
                            Ficha de Inscrição
                        </h1>
                        <p class="text-gray-500 text-sm" id="form-subtitle">
                            Preencha com calma e atenção todos os dados
                        </p>
                    </div>
                    <button 
                        id="back-to-login-btn" 
                        class="text-gray-600 hover:text-gray-800 flex items-center gap-2 text-sm font-medium px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"
                    >
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        <span class="hidden md:inline">Voltar</span>
                    </button>
                </div>

                <!-- Alerta Informativo -->
                <div class="bg-blue-50 p-4 border-b border-blue-100">
                    <div class="flex items-start gap-3">
                        <i data-lucide="info" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                        <div class="text-sm text-blue-800">
                            <p class="font-semibold mb-1">Dica Importante:</p>
                            <p>Não se preocupe com letras maiúsculas ou minúsculas. O sistema padronizará automaticamente todos os dados ao salvar. Apenas preencha corretamente.</p>
                        </div>
                    </div>
                </div>

                <form id="register-form" class="p-6 space-y-8">
                    <!-- Campo oculto para ID de edição -->
                    <input type="hidden" id="editing-id" value="">

                    <!-- ===== IDENTIFICAÇÃO ===== -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="p-2.5 bg-pink-100 rounded-lg text-pink-600">
                                <i data-lucide="map-pin" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Local e Data</h3>
                                <p class="text-sm text-gray-500">Identifique onde você realiza as aulas</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div id="polo-container">
                                <label for="polo" class="form-label">
                                    Qual é o seu Polo? <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="polo" 
                                    class="form-input" 
                                    placeholder="Ex: CENTRO, ZONA NORTE..." 
                                    required
                                >
                            </div>
                            
                            <div>
                                <label for="inscricao" class="form-label">Nº Inscrição</label>
                                <input 
                                    type="text" 
                                    id="inscricao" 
                                    class="form-input bg-gray-100 font-bold text-pink-600 border-pink-200" 
                                    readonly 
                                    value="Automático"
                                    tabindex="-1"
                                >
                            </div>
                            
                            <div>
                                <label for="data" class="form-label">Data de Hoje</label>
                                <input 
                                    type="date" 
                                    id="data" 
                                    class="form-input bg-gray-100 cursor-not-allowed" 
                                    required 
                                    readonly
                                    tabindex="-1"
                                >
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-gray-200"></div>

                    <!-- ===== DADOS PESSOAIS ===== -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="p-2.5 bg-pink-100 rounded-lg text-pink-600">
                                <i data-lucide="user" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Seus Dados Pessoais</h3>
                                <p class="text-sm text-gray-500">Informe seus dados conforme documento de identidade</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div class="md:col-span-2">
                                <label for="nome" class="form-label">
                                    Nome Completo <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="nome" 
                                    class="form-input text-lg" 
                                    placeholder="Digite seu nome completo" 
                                    required
                                    autocomplete="name"
                                >
                            </div>
                            
                            <div>
                                <label class="form-label">
                                    Sexo <span class="text-red-500">*</span>
                                </label>
                                <div class="flex gap-4 mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200">
                                    <label class="flex items-center gap-2 cursor-pointer text-base">
                                        <input 
                                            type="radio" 
                                            name="sexo" 
                                            value="Feminino" 
                                            class="w-4 h-4 text-pink-600 focus:ring-pink-500" 
                                            required
                                        > 
                                        Feminino
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer text-base">
                                        <input 
                                            type="radio" 
                                            name="sexo" 
                                            value="Masculino" 
                                            class="w-4 h-4 text-pink-600 focus:ring-pink-500" 
                                            required
                                        > 
                                        Masculino
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label for="dataNascimento" class="form-label">
                                    Data de Nascimento <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="date" 
                                    id="dataNascimento" 
                                    class="form-input" 
                                    required
                                    max=""
                                    autocomplete="bday"
                                >
                            </div>
                            
                            <div>
                                <label for="idade" class="form-label">Sua Idade</label>
                                <input 
                                    type="number" 
                                    id="idade" 
                                    class="form-input bg-gray-100 font-bold" 
                                    readonly 
                                    required 
                                    placeholder="Calculada automaticamente"
                                    tabindex="-1"
                                >
                            </div>
                            
                            <div>
                                <label for="telefone" class="form-label">
                                    WhatsApp / Telefone <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="tel" 
                                    id="telefone" 
                                    class="form-input font-semibold tracking-wider" 
                                    placeholder="(98) 98765-4321" 
                                    maxlength="15" 
                                    required
                                    autocomplete="tel"
                                >
                            </div>
                        </div>

                        <!-- Endereço -->
                        <div class="card p-5 bg-gray-50 border-gray-200 mt-5">
                            <h4 class="font-bold text-gray-700 mb-4 pb-2 border-b border-gray-300 flex items-center gap-2">
                                <i data-lucide="home" class="w-4 h-4"></i>
                                Endereço Residencial
                            </h4>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="cep" class="form-label text-sm">CEP (Opcional)</label>
                                    <input 
                                        type="text" 
                                        id="cep" 
                                        class="form-input" 
                                        placeholder="00000-000" 
                                        maxlength="9"
                                        autocomplete="postal-code"
                                    >
                                </div>
                                <div class="md:col-span-2">
                                    <label for="endereco" class="form-label text-sm">Rua/Avenida</label>
                                    <input 
                                        type="text" 
                                        id="endereco" 
                                        class="form-input"
                                        placeholder="Nome da rua"
                                        autocomplete="street-address"
                                    >
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-3">
                                <div>
                                    <label for="numero" class="form-label text-sm">Número</label>
                                    <input 
                                        type="text" 
                                        id="numero" 
                                        class="form-input"
                                        placeholder="123"
                                    >
                                </div>
                                <div class="md:col-span-2">
                                    <label for="bairro" class="form-label text-sm">Bairro</label>
                                    <input 
                                        type="text" 
                                        id="bairro" 
                                        class="form-input"
                                        placeholder="Nome do bairro"
                                    >
                                </div>
                                <div>
                                    <label for="cidade" class="form-label text-sm">Cidade</label>
                                    <input 
                                        type="text" 
                                        id="cidade" 
                                        class="form-input"
                                        placeholder="São Luís"
                                        autocomplete="address-level2"
                                    >
                                </div>
                                <input type="hidden" id="uf" value="MA">
                            </div>
                        </div>

                        <!-- Documentos e Dados Complementares -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div>
                                <label for="cpf" class="form-label">
                                    CPF <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="cpf" 
                                    class="form-input font-mono" 
                                    placeholder="000.000.000-00" 
                                    required 
                                    maxlength="14"
                                    inputmode="numeric"
                                >
                            </div>
                            
                            <div>
                                <label for="rg" class="form-label">RG</label>
                                <input 
                                    type="text" 
                                    id="rg" 
                                    class="form-input" 
                                    placeholder="Números do RG"
                                    inputmode="numeric"
                                >
                            </div>
                            
                            <div>
                                <label for="profissao" class="form-label">Profissão</label>
                                <input 
                                    type="text" 
                                    id="profissao" 
                                    class="form-input"
                                    placeholder="Ex: Professora"
                                >
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="form-label text-sm">Estado Civil</label>
                                <select id="estadoCivil" class="form-select">
                                    <option value="">Selecione...</option>
                                    <option value="Solteiro(a)">Solteiro(a)</option>
                                    <option value="Casado(a)">Casado(a)</option>
                                    <option value="Divorciado(a)">Divorciado(a)</option>
                                    <option value="Viúvo(a)">Viúvo(a)</option>
                                    <option value="União Estável">União Estável</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Mora em casa própria?</label>
                                <select id="casaPropria" class="form-select">
                                    <option value="Sim">Sim</option>
                                    <option value="Não">Não</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="zona" class="form-label text-sm">Zona Eleitoral</label>
                                <input 
                                    type="text" 
                                    id="zona" 
                                    class="form-input"
                                    placeholder="Número da zona"
                                >
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-gray-200"></div>

                    <!-- ===== TAMANHO DA CAMISA ===== -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="p-2.5 bg-pink-100 rounded-lg text-pink-600">
                                <i data-lucide="shirt" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Tamanho da Camisa</h3>
                                <p class="text-sm text-gray-500">Selecione o tamanho que você usa</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-5 rounded-lg border border-gray-200">
                            <div class="flex flex-wrap gap-3 justify-center md:justify-start">
                                <label class="cursor-pointer border-2 border-gray-300 px-6 py-4 rounded-lg hover:bg-pink-50 hover:border-pink-300 has-[:checked]:bg-pink-100 has-[:checked]:border-pink-600 has-[:checked]:text-pink-800 font-bold text-lg transition-all w-20 text-center shadow-sm">
                                    <input type="radio" name="camisa" value="PP" class="hidden"> PP
                                </label>
                                <label class="cursor-pointer border-2 border-gray-300 px-6 py-4 rounded-lg hover:bg-pink-50 hover:border-pink-300 has-[:checked]:bg-pink-100 has-[:checked]:border-pink-600 has-[:checked]:text-pink-800 font-bold text-lg transition-all w-20 text-center shadow-sm">
                                    <input type="radio" name="camisa" value="P" class="hidden"> P
                                </label>
                                <label class="cursor-pointer border-2 border-gray-300 px-6 py-4 rounded-lg hover:bg-pink-50 hover:border-pink-300 has-[:checked]:bg-pink-100 has-[:checked]:border-pink-600 has-[:checked]:text-pink-800 font-bold text-lg transition-all w-20 text-center shadow-sm">
                                    <input type="radio" name="camisa" value="M" class="hidden"> M
                                </label>
                                <label class="cursor-pointer border-2 border-gray-300 px-6 py-4 rounded-lg hover:bg-pink-50 hover:border-pink-300 has-[:checked]:bg-pink-100 has-[:checked]:border-pink-600 has-[:checked]:text-pink-800 font-bold text-lg transition-all w-20 text-center shadow-sm">
                                    <input type="radio" name="camisa" value="G" class="hidden"> G
                                </label>
                                <label class="cursor-pointer border-2 border-gray-300 px-6 py-4 rounded-lg hover:bg-pink-50 hover:border-pink-300 has-[:checked]:bg-pink-100 has-[:checked]:border-pink-600 has-[:checked]:text-pink-800 font-bold text-lg transition-all w-20 text-center shadow-sm">
                                    <input type="radio" name="camisa" value="GG" class="hidden"> GG
                                </label>
                                
                                <div class="flex items-center gap-2">
                                    <label class="cursor-pointer border-2 border-gray-300 px-6 py-4 rounded-lg hover:bg-pink-50 hover:border-pink-300 has-[:checked]:bg-pink-100 has-[:checked]:border-pink-600 has-[:checked]:text-pink-800 font-bold text-lg transition-all shadow-sm">
                                        <input type="radio" name="camisa" value="Outro" class="hidden"> Extra
                                    </label>
                                    <input 
                                        type="text" 
                                        id="camisaOutro" 
                                        class="form-input py-3 text-base w-32" 
                                        placeholder="Ex: XG, G1..."
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-gray-200"></div>

                    <!-- ===== SAÚDE E BEM-ESTAR ===== -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="p-2.5 bg-pink-100 rounded-lg text-pink-600">
                                <i data-lucide="activity" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Saúde e Bem-estar</h3>
                                <p class="text-sm text-gray-500">Responda com sinceridade para sua segurança</p>
                            </div>
                        </div>

                        <!-- Grid de Perguntas Sim/Não -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 bg-gray-50 p-5 rounded-xl border border-gray-200">
                            <template id="health-question-template">
                                <div class="flex items-center justify-between gap-3 p-3 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                                    <label class="text-sm font-semibold text-gray-700 flex-1"></label>
                                    <select class="form-select w-24 text-sm py-2 font-bold">
                                        <option value="Não">Não</option>
                                        <option value="Sim">Sim</option>
                                    </select>
                                </div>
                            </template>
                            <div id="health-questions-container" class="contents"></div>
                        </div>

                        <!-- Informações Detalhadas de Saúde -->
                        <div class="space-y-4 mt-5">
                            <div>
                                <label for="tipoSanguineo" class="form-label text-sm">
                                    Tipo Sanguíneo (Se souber)
                                </label>
                                <input 
                                    type="text" 
                                    id="tipoSanguineo" 
                                    class="form-input w-full md:w-1/3" 
                                    placeholder="Ex: O+, A-, B+..."
                                >
                            </div>
                            
                            <div class="card p-5 border-yellow-200 bg-yellow-50">
                                <h4 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <i data-lucide="alert-circle" class="w-5 h-5 text-yellow-600"></i>
                                    Observações Importantes
                                </h4>
                                
                                <div class="space-y-4">
                                    <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
                                        <label class="w-full md:w-48 font-bold text-gray-700 text-sm">
                                            Tem Alergias?
                                        </label>
                                        <select id="alergias" class="form-select w-28 py-2 text-sm">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            id="alergiasQual" 
                                            class="form-input flex-grow text-sm" 
                                            placeholder="Se sim, quais?"
                                        >
                                    </div>
                                    
                                    <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
                                        <label class="w-full md:w-48 font-bold text-gray-700 text-sm">
                                            Cirurgia Recente?
                                        </label>
                                        <select id="cirurgiaRecente" class="form-select w-28 py-2 text-sm">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            id="cirurgiaRecenteQual" 
                                            class="form-input flex-grow text-sm" 
                                            placeholder="Qual e quando?"
                                        >
                                    </div>
                                    
                                    <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
                                        <label class="w-full md:w-48 font-bold text-gray-700 text-sm">
                                            Em Tratamento Médico?
                                        </label>
                                        <select id="tratamentoMedico" class="form-select w-28 py-2 text-sm">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            id="tratamentoMedicoQual" 
                                            class="form-input flex-grow text-sm" 
                                            placeholder="Qual tratamento?"
                                        >
                                    </div>
                                    
                                    <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
                                        <label class="w-full md:w-48 font-bold text-gray-700 text-sm">
                                            Toma Remédios?
                                        </label>
                                        <select id="tomaMedicamento" class="form-select w-28 py-2 text-sm">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            id="tomaMedicamentoQual" 
                                            class="form-input flex-grow text-sm" 
                                            placeholder="Quais medicamentos?"
                                        >
                                    </div>
                                    
                                    <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
                                        <label class="w-full md:w-48 font-bold text-gray-700 text-sm">
                                            Problema Ortopédico?
                                        </label>
                                        <select id="problemaOrtopedico" class="form-select w-28 py-2 text-sm">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                        <input 
                                            type="text" 
                                            id="problemaOrtopedicoQual" 
                                            class="form-input flex-grow text-sm" 
                                            placeholder="Joelho, coluna, artrose...?"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botão de Submissão -->
                    <div class="pt-6">
                        <button 
                            type="submit" 
                            id="submit-register-btn" 
                            class="w-full btn btn-primary py-4 text-xl font-bold shadow-lg transform transition-all hover:scale-[1.02] rounded-xl"
                        >
                            <span id="submit-text" class="flex items-center justify-center gap-2">
                                <i data-lucide="check-circle" class="w-6 h-6"></i>
                                CONFIRMAR MINHA INSCRIÇÃO
                            </span>
                            <span id="submit-loading" class="hidden-section flex items-center justify-center gap-2">
                                <div class="loading-spinner"></div>
                                Salvando dados...
                            </span>
                        </button>
                        <p id="register-message" class="mt-4 text-center text-lg font-bold"></p>
                    </div>
                </form>
            </div>
        </section>

        <!-- ===== PAINEL DO ADMIN ===== -->
        <section id="admin-panel" class="hidden-section flex-grow flex flex-col bg-gray-100">
            <!-- Header -->
            <header class="bg-white shadow-sm z-30 sticky top-0">
                <div class="container mx-auto px-4 h-16 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center text-white shadow-md">
                            <i data-lucide="layout-dashboard" class="w-6 h-6"></i>
                        </div>
                        <div class="hidden md:block">
                            <span class="font-bold text-xl text-gray-800 tracking-tight">Painel Administrativo</span>
                            <p class="text-xs text-gray-500">Projeto Zumba</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <span class="text-sm text-gray-500 hidden md:inline flex items-center gap-2">
                            <i data-lucide="shield-check" class="w-4 h-4 text-green-600"></i>
                            Administrador
                        </span>
                        <button 
                            id="admin-logout-btn" 
                            class="btn btn-secondary text-sm py-2 px-4 flex items-center gap-2 text-red-600 hover:bg-red-50 border-red-200 font-semibold"
                        >
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            <span class="hidden md:inline">Sair</span>
                        </button>
                    </div>
                </div>
                
                <!-- Tabs de Navegação -->
                <div class="container mx-auto px-4 border-t border-gray-100 overflow-x-auto">
                    <nav class="flex gap-2 min-w-max" id="admin-tabs">
                        <button class="nav-tab active" data-tab="dashboard">
                            <i data-lucide="bar-chart-2" class="w-4 h-4 inline mr-2"></i>
                            <span class="hidden md:inline">Visão Geral</span>
                            <span class="md:hidden">Dashboard</span>
                        </button>
                        <button class="nav-tab" data-tab="participants">
                            <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>
                            Participantes
                        </button>
                        <button class="nav-tab" data-tab="reports">
                            <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>
                            Relatórios
                        </button>
                        <button class="nav-tab" data-tab="settings">
                            <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>
                            Config
                        </button>
                    </nav>
                </div>
            </header>

            <!-- Conteúdo Principal -->
            <main class="container mx-auto px-4 py-8 flex-grow">
                
                <!-- TAB: DASHBOARD -->
                <div id="tab-dashboard" class="admin-tab-content space-y-6">
                    <!-- Cards de Estatísticas -->
                    <div id="admin-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Preenchido via JS -->
                    </div>
                    
                    <!-- Lista de Pendentes -->
                    <div class="card overflow-hidden">
                        <div class="p-5 border-b border-gray-100 bg-yellow-50 flex justify-between items-center">
                            <h2 class="text-lg font-bold text-yellow-800 flex items-center gap-2">
                                <i data-lucide="alert-circle" class="w-5 h-5"></i>
                                Inscrições Pendentes de Aprovação
                            </h2>
                            <span class="badge badge-warning font-bold" id="pending-count-badge">0</span>
                        </div>
                        <div class="p-5">
                            <div id="pending-registrations-list" class="grid grid-cols-1 gap-3">
                                <!-- Preenchido via JS -->
                            </div>
                            <div id="no-pending-message" class="text-center py-12 text-gray-400 hidden-section">
                                <i data-lucide="check-circle-2" class="w-16 h-16 mx-auto mb-4 text-green-200"></i>
                                <p class="text-lg font-medium text-green-600">Tudo em dia!</p>
                                <p>Nenhuma inscrição pendente no momento.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: PARTICIPANTES -->
                <div id="tab-participants" class="admin-tab-content hidden-section card flex flex-col h-[calc(100vh-10rem)]">
                    <!-- Barra de Filtros -->
                    <div class="p-5 border-b border-gray-200 flex flex-col md:flex-row gap-4 justify-between items-center bg-gray-50">
                        <h2 class="text-lg font-bold text-gray-700 flex items-center gap-2">
                            <i data-lucide="database" class="w-5 h-5"></i>
                            Base de Dados Completa
                        </h2>
                        <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                            <div class="relative w-full md:w-72">
                                <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                                <input 
                                    id="admin-search" 
                                    type="text" 
                                    class="form-input pl-10 text-sm py-2" 
                                    placeholder="Buscar por Nome, CPF ou Polo..."
                                    style="text-transform: none;"
                                >
                            </div>
                            <select id="admin-sort" class="form-select w-full md:w-auto text-sm py-2">
                                <option value="date_desc">Mais Recentes</option>
                                <option value="name_asc">Nome (A-Z)</option>
                                <option value="polo_asc">Agrupar por Polo</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Tabela -->
                    <div class="flex-grow overflow-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                        Inscrição / Nome
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                        Polo
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                        Contato / CPF
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                        Camisa
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                        Status
                                    </th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">Ações</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="all-participants-table-body" class="bg-white divide-y divide-gray-200 text-sm">
                                <!-- Preenchido via JS -->
                            </tbody>
                        </table>
                        <div id="no-participants-message" class="text-center py-20 text-gray-400 hidden-section">
                            <i data-lucide="inbox" class="w-16 h-16 mx-auto mb-4 text-gray-200"></i>
                            <p class="text-lg font-medium">Nenhum registro encontrado</p>
                            <p class="text-sm">Tente ajustar os filtros de busca</p>
                        </div>
                    </div>
                    
                    <!-- Footer com contagem -->
                    <div class="p-3 border-t border-gray-200 bg-gray-50 text-xs text-gray-600 text-right font-medium flex justify-between items-center" id="table-footer">
                        <span id="table-footer-count">Carregando dados...</span>
                        <button 
                            id="refresh-data-btn" 
                            class="btn btn-secondary py-1 px-3 text-xs"
                            title="Atualizar dados"
                        >
                            <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                        </button>
                    </div>
                </div>

                <!-- TAB: RELATÓRIOS -->
                <div id="tab-reports" class="admin-tab-content hidden-section space-y-6">
                    <!-- Gerador de Relatórios -->
                    <div class="card p-6">
                        <div class="flex items-center gap-3 mb-6 pb-4 border-b">
                            <div class="p-2 bg-blue-100 text-blue-600 rounded-lg">
                                <i data-lucide="filter" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">Gerador de Relatórios</h2>
                                <p class="text-sm text-gray-500">Filtre e exporte dados personalizados</p>
                            </div>
                        </div>
                        
                        <!-- Filtros -->
                        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
                            <div>
                                <label class="form-label text-sm">Status</label>
                                <select id="report-status-filter" class="form-select text-sm">
                                    <option value="approved">Aprovados</option>
                                    <option value="all">Todos</option>
                                    <option value="pending">Pendentes</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Filtrar por Polo</label>
                                <select id="report-polo-filter" class="form-select text-sm bg-blue-50 border-blue-200">
                                    <option value="all">Todos os Polos</option>
                                    <!-- Preenchido via JS -->
                                </select>
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Tamanho Camisa</label>
                                <select id="report-camisa-filter" class="form-select text-sm">
                                    <option value="all">Todos</option>
                                    <option value="PP">PP</option>
                                    <option value="P">P</option>
                                    <option value="M">M</option>
                                    <option value="G">G</option>
                                    <option value="GG">GG</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Sexo</label>
                                <select id="report-sexo-filter" class="form-select text-sm">
                                    <option value="all">Todos</option>
                                    <option value="Feminino">Feminino</option>
                                    <option value="Masculino">Masculino</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Cidade</label>
                                <input 
                                    type="text" 
                                    id="report-city-filter" 
                                    class="form-input text-sm" 
                                    placeholder="Ex: SÃO LUÍS"
                                >
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Idade Mínima</label>
                                <input 
                                    type="number" 
                                    id="report-age-min" 
                                    class="form-input text-sm"
                                    placeholder="0"
                                    min="0"
                                >
                            </div>
                            
                            <div>
                                <label class="form-label text-sm">Idade Máxima</label>
                                <input 
                                    type="number" 
                                    id="report-age-max" 
                                    class="form-input text-sm"
                                    placeholder="120"
                                    min="0"
                                >
                            </div>
                        </div>

                        <!-- Seleção de Colunas -->
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6">
                            <h3 class="text-xs font-bold text-gray-600 uppercase tracking-wide mb-3 flex items-center gap-2">
                                <i data-lucide="columns" class="w-4 h-4"></i>
                                Selecione as colunas para o relatório
                            </h3>
                            <div id="report-fields" class="flex flex-wrap gap-3 text-sm">
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="nome" checked class="text-pink-600 rounded focus:ring-pink-500"> Nome
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="polo" checked class="text-pink-600 rounded focus:ring-pink-500"> Polo
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="camisa" checked class="text-pink-600 rounded focus:ring-pink-500"> Camisa
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="telefone" checked class="text-pink-600 rounded focus:ring-pink-500"> Telefone
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="idade" checked class="text-pink-600 rounded focus:ring-pink-500"> Idade
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="bairro" checked class="text-pink-600 rounded focus:ring-pink-500"> Bairro
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="status" class="text-pink-600 rounded focus:ring-pink-500"> Status
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="cpf" class="text-pink-600 rounded focus:ring-pink-500"> CPF
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="inscricao" class="text-pink-600 rounded focus:ring-pink-500"> Nº Insc.
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="zona" class="text-pink-600 rounded focus:ring-pink-500"> Zona Eleitoral
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="hipertenso" class="text-pink-600 rounded focus:ring-pink-500"> Hipertenso
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-gray-300 hover:border-pink-400 hover:bg-pink-50 transition-colors">
                                    <input type="checkbox" value="diabetico" class="text-pink-600 rounded focus:ring-pink-500"> Diabético
                                </label>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="flex flex-wrap gap-3">
                            <button id="generate-report-btn" class="btn btn-primary shadow-md">
                                <i data-lucide="search" class="w-4 h-4 mr-2"></i>
                                Gerar Relatório
                            </button>
                            <button id="clear-filters-btn" class="btn btn-secondary">
                                <i data-lucide="x" class="w-4 h-4 mr-2"></i>
                                Limpar Filtros
                            </button>
                        </div>
                    </div>

                    <!-- Resultados do Relatório -->
                    <div id="report-results-container" class="hidden-section card p-6">
                        <!-- Resumo -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 bg-blue-50 p-5 rounded-lg border border-blue-100">
                            <div class="text-center border-r border-blue-200 last:border-0 p-3">
                                <span class="block text-sm text-blue-700 font-bold uppercase mb-2">Total Encontrado</span>
                                <span class="text-5xl font-bold text-gray-800" id="summary-total">0</span>
                            </div>
                            <div class="col-span-2 text-sm pl-4 flex flex-col justify-center">
                                <p class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                                    <i data-lucide="shirt" class="w-4 h-4"></i>
                                    Resumo de Camisas (Filtro Aplicado):
                                </p>
                                <div id="summary-camisas" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>

                        <!-- Tabela de Resultados -->
                        <div class="overflow-x-auto border rounded-lg mb-4 max-h-[500px]">
                            <table class="min-w-full divide-y divide-gray-200" id="report-table">
                                <thead class="bg-gray-100 sticky top-0 shadow-sm" id="report-table-head"></thead>
                                <tbody class="bg-white divide-y divide-gray-200 text-xs" id="report-table-body"></tbody>
                            </table>
                        </div>

                        <!-- Botões de Exportação -->
                        <div class="flex flex-wrap justify-end gap-2 border-t pt-4">
                            <span class="text-sm text-gray-500 self-center mr-2 flex items-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i>
                                Exportar dados:
                            </span>
                            <button id="export-csv-btn" class="btn btn-secondary text-sm gap-2 hover:text-green-600 hover:border-green-300">
                                <i data-lucide="file-spreadsheet" class="w-4 h-4"></i> Excel (CSV)
                            </button>
                            <button id="export-xlsx-btn" class="btn btn-secondary text-sm gap-2 hover:text-green-600 hover:border-green-300">
                                <i data-lucide="sheet" class="w-4 h-4"></i> Excel (XLSX)
                            </button>
                            <button id="export-pdf-btn" class="btn btn-secondary text-sm gap-2 hover:text-red-600 hover:border-red-300">
                                <i data-lucide="file-text" class="w-4 h-4"></i> PDF (Lista)
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- TAB: CONFIGURAÇÕES -->
                <div id="tab-settings" class="admin-tab-content hidden-section">
                    <div class="card p-6 max-w-3xl mx-auto">
                        <div class="flex items-center gap-3 mb-6 pb-4 border-b">
                            <i data-lucide="settings" class="w-6 h-6 text-gray-500"></i>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">Configurações do Sistema</h2>
                                <p class="text-sm text-gray-500">Gerencie polos e manutenção</p>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <!-- Configuração de Polos -->
                            <div class="card p-5 bg-gray-50 border-gray-200">
                                <label class="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
                                    <i data-lucide="map-pin" class="w-4 h-4 text-blue-600"></i>
                                    Lista de Polos Oficiais
                                </label>
                                <p class="text-xs text-gray-600 mb-3 pl-6">
                                    Digite os nomes dos polos separados por vírgula. Isso criará uma lista fixa no formulário de inscrição, evitando erros de digitação.
                                </p>
                                <textarea 
                                    id="settings-polos" 
                                    class="form-input w-full h-32 font-mono text-sm resize-y" 
                                    placeholder="CENTRO, ZONA NORTE, ZONA SUL, COHATRAC, CIDADE OPERÁRIA..."
                                ></textarea>
                                <div class="mt-3 flex justify-end">
                                    <button id="save-settings-btn" class="btn btn-primary text-sm">
                                        <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                                        Salvar Lista de Polos
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Zona de Manutenção -->
                            <div class="card p-5 border-red-200 bg-red-50">
                                <label class="block text-sm font-bold text-red-800 mb-2 flex items-center gap-2">
                                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                                    Zona de Manutenção
                                </label>
                                <p class="text-xs text-red-700 mb-4">
                                    <strong>Atenção:</strong> Use isto apenas se a numeração das inscrições estiver desorganizada. Esta ação irá renumerar TODOS os cadastros sequencialmente com base na data de criação.
                                </p>
                                <button id="renumber-all-btn" class="btn btn-danger text-sm w-full md:w-auto">
                                    <span id="renumber-text" class="flex items-center gap-2">
                                        <i data-lucide="hash" class="w-4 h-4"></i>
                                        Renumerar Automaticamente
                                    </span>
                                    <span id="renumber-loading" class="hidden-section flex items-center gap-2">
                                        <div class="loading-spinner"></div>
                                        Processando...
                                    </span>
                                </button>
                                <p id="renumber-status" class="mt-3 text-xs font-bold text-center"></p>
                            </div>

                            <!-- Informações do Sistema -->
                            <div class="card p-5 bg-blue-50 border-blue-200">
                                <h3 class="text-sm font-bold text-blue-800 mb-3 flex items-center gap-2">
                                    <i data-lucide="info" class="w-4 h-4"></i>
                                    Sobre o Sistema
                                </h3>
                                <dl class="text-xs space-y-2">
                                    <div class="flex justify-between">
                                        <dt class="text-gray-600">Versão:</dt>
                                        <dd class="font-mono font-bold text-gray-800">2.0.0</dd>
                                    </div>
                                    <div class="flex justify-between">
                                        <dt class="text-gray-600">Desenvolvido para:</dt>
                                        <dd class="font-bold text-gray-800">SEMCAS - São Luís/MA</dd>
                                    </div>
                                    <div class="flex justify-between">
                                        <dt class="text-gray-600">Banco de Dados:</dt>
                                        <dd class="font-mono text-gray-800">Firebase Firestore</dd>
                                    </div>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </section>

        <!-- ===== MODAL DE EDIÇÃO AVANÇADA ===== -->
        <div id="details-modal" class="modal-overlay">
            <div class="modal-content w-full max-w-4xl">
                <!-- Header do Modal -->
                <div class="p-5 border-b flex justify-between items-center bg-gray-50">
                    <div>
                        <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">
                            <i data-lucide="edit-3" class="w-5 h-5 text-pink-600"></i>
                            Editar Ficha do Participante
                        </h3>
                        <p class="text-xs text-gray-500 mt-1">
                            Alterações são salvas automaticamente no banco de dados
                        </p>
                    </div>
                    <button 
                        id="close-modal-btn" 
                        class="p-2 hover:bg-gray-200 rounded-full transition-colors"
                        aria-label="Fechar modal"
                    >
                        <i data-lucide="x" class="w-6 h-6 text-gray-500"></i>
                    </button>
                </div>
                
                <!-- Corpo do Modal (Scrollable) -->
                <div class="p-6 overflow-y-auto max-h-[70vh] bg-white">
                    <form id="edit-form" class="space-y-6">
                        <input type="hidden" id="edit-doc-id">
                        
                        <!-- Barra de Status -->
                        <div class="flex flex-col md:flex-row gap-4 p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg border border-gray-200 items-end">
                            <div class="w-full md:w-1/3">
                                <label class="text-xs font-bold text-gray-600 uppercase flex items-center gap-1 mb-1">
                                    <i data-lucide="flag" class="w-3 h-3"></i>
                                    Status da Inscrição
                                </label>
                                <select id="edit-status" class="form-select font-bold">
                                    <option value="pending" style="color: #d97706;">PENDENTE</option>
                                    <option value="approved" style="color: #059669;">APROVADO</option>
                                    <option value="rejected" style="color: #dc2626;">REJEITADO</option>
                                </select>
                            </div>
                            <div class="w-full md:w-1/3">
                                <label class="text-xs font-bold text-gray-600 uppercase flex items-center gap-1 mb-1">
                                    <i data-lucide="hash" class="w-3 h-3"></i>
                                    Número Inscrição
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-inscricao" 
                                    class="form-input bg-gray-100 font-mono" 
                                    readonly
                                    tabindex="-1"
                                >
                            </div>
                            <div class="w-full md:w-1/3">
                                <label class="text-xs font-bold text-gray-600 uppercase flex items-center gap-1 mb-1">
                                    <i data-lucide="calendar" class="w-3 h-3"></i>
                                    Data Cadastro
                                </label>
                                <input 
                                    type="text" 
                                    id="edit-createdAtDisplay" 
                                    class="form-input bg-gray-100" 
                                    readonly
                                    tabindex="-1"
                                >
                            </div>
                        </div>

                        <!-- Grid de Edição -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Coluna 1: Dados Pessoais -->
                            <div class="space-y-4">
                                <h4 class="font-bold text-pink-600 border-b pb-2 flex items-center gap-2">
                                    <i data-lucide="user" class="w-4 h-4"></i>
                                    Dados Pessoais
                                </h4>
                                <div>
                                    <label class="form-label text-sm">Nome Completo</label>
                                    <input type="text" id="edit-nome" class="form-input">
                                </div>
                                <div>
                                    <label class="form-label text-sm">CPF</label>
                                    <input type="text" id="edit-cpf" class="form-input font-mono">
                                </div>
                                <div>
                                    <label class="form-label text-sm">RG</label>
                                    <input type="text" id="edit-rg" class="form-input">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="form-label text-sm">Data Nascimento</label>
                                        <input type="date" id="edit-dataNascimento" class="form-input text-sm">
                                    </div>
                                    <div>
                                        <label class="form-label text-sm">Idade</label>
                                        <input 
                                            type="number" 
                                            id="edit-idade" 
                                            class="form-input bg-gray-100 text-sm"
                                            readonly
                                        >
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="form-label text-sm">Sexo</label>
                                        <select id="edit-sexo" class="form-select text-sm">
                                            <option value="Feminino">Feminino</option>
                                            <option value="Masculino">Masculino</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="form-label text-sm">Camisa</label>
                                        <input type="text" id="edit-camisa" class="form-input text-sm">
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label text-sm">Telefone/WhatsApp</label>
                                    <input type="text" id="edit-telefone" class="form-input font-semibold">
                                </div>
                            </div>

                            <!-- Coluna 2: Endereço e Polo -->
                            <div class="space-y-4">
                                <h4 class="font-bold text-pink-600 border-b pb-2 flex items-center gap-2">
                                    <i data-lucide="map-pin" class="w-4 h-4"></i>
                                    Endereço e Polo
                                </h4>
                                <div>
                                    <label class="form-label text-sm">Polo</label>
                                    <input 
                                        type="text" 
                                        id="edit-polo" 
                                        class="form-input font-bold text-blue-800"
                                    >
                                </div>
                                <div>
                                    <label class="form-label text-sm">CEP</label>
                                    <input type="text" id="edit-cep" class="form-input text-sm">
                                </div>
                                <div>
                                    <label class="form-label text-sm">Logradouro</label>
                                    <input type="text" id="edit-endereco" class="form-input text-sm">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="form-label text-sm">Bairro</label>
                                        <input type="text" id="edit-bairro" class="form-input text-sm">
                                    </div>
                                    <div>
                                        <label class="form-label text-sm">Número</label>
                                        <input type="text" id="edit-numero" class="form-input text-sm">
                                    </div>
                                </div>
                                <div>
                                    <label class="form-label text-sm">Cidade</label>
                                    <input type="text" id="edit-cidade" class="form-input text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Dados Complementares & Saúde -->
                        <div class="card p-5 bg-gray-50 border-gray-200 space-y-4">
                            <h4 class="font-bold text-gray-700 text-sm uppercase flex items-center gap-2 border-b pb-2">
                                <i data-lucide="clipboard" class="w-4 h-4"></i>
                                Dados Complementares & Saúde
                            </h4>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Profissão</label>
                                    <input type="text" id="edit-profissao" class="form-input text-sm py-2">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Estado Civil</label>
                                    <input type="text" id="edit-estadoCivil" class="form-input text-sm py-2">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Zona Eleitoral</label>
                                    <input type="text" id="edit-zona" class="form-input text-sm py-2">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Tipo Sanguíneo</label>
                                    <input type="text" id="edit-tipoSanguineo" class="form-input text-sm py-2">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Observações de Saúde</label>
                                    <textarea 
                                        id="edit-obs-saude" 
                                        class="form-input text-sm" 
                                        rows="4" 
                                        placeholder="Alergias, cirurgias, tratamentos..."
                                    ></textarea>
                                </div>
                                <div class="flex flex-col justify-end">
                                    <div class="flex flex-wrap gap-4 text-sm font-bold text-gray-700 border border-gray-300 p-4 bg-white rounded-lg">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                id="edit-check-hipertenso" 
                                                class="w-4 h-4 text-pink-600 rounded"
                                            > 
                                            Hipertenso
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                id="edit-check-diabetico" 
                                                class="w-4 h-4 text-pink-600 rounded"
                                            > 
                                            Diabético
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                id="edit-check-cardiaco" 
                                                class="w-4 h-4 text-pink-600 rounded"
                                            > 
                                            Cardíaco
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Footer do Modal -->
                <div class="p-5 border-t bg-gray-50 flex flex-col md:flex-row justify-between items-center gap-3">
                    <button 
                        id="modal-delete-btn" 
                        class="btn btn-danger text-sm flex gap-2 w-full md:w-auto"
                    >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                        Excluir Definitivamente
                    </button>
                    <div class="flex gap-3 w-full md:w-auto">
                        <button 
                            type="button"
                            id="modal-cancel-btn"
                            class="btn btn-secondary text-sm flex-1 md:flex-initial"
                        >
                            Cancelar
                        </button>
                        <button 
                            id="modal-save-btn" 
                            class="btn btn-success text-sm px-6 py-2.5 font-bold flex gap-2 flex-1 md:flex-initial"
                        >
                            <i data-lucide="save" class="w-4 h-4"></i>
                            SALVAR ALTERAÇÕES
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ===== FIREBASE & LÓGICA JAVASCRIPT ===== -->
    <script type="module">
        // ===========================================
        // IMPORTS DO FIREBASE
        // ===========================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            signInAnonymously, 
            signOut, 
            onAuthStateChanged, 
            setPersistence, 
            browserLocalPersistence 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            doc, 
            getDoc, 
            updateDoc, 
            deleteDoc, 
            onSnapshot, 
            setDoc, 
            getCountFromServer 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ===========================================
        // CONFIGURAÇÃO DO FIREBASE
        // ===========================================
        const firebaseConfig = {
          apiKey: "AIzaSyCrH_LFHenyWx-ITRCTWeNVqf8O-0e3pJY",
          authDomain: "zumba-2a827.firebaseapp.com",
          projectId: "zumba-2a827",
          storageBucket: "zumba-2a827.firebasestorage.app",
          messagingSenderId: "325248310095",
          appId: "1:325248310095:web:2673845967b7bc60f6833a"
        };
        
        const ADMIN_UID = "mNenvFEpf1SnDCY2kXLUaDlgtP03";
        const INSCRICOES_COLLECTION = "inscricoes_zumba";
        const SETTINGS_COLLECTION = "config_zumba";

        // Inicialização
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (error) {
            console.error("Firebase Error:", error);
            alert("Erro ao conectar com o banco de dados. Verifique sua conexão.");
        }

        // ===========================================
        // ELEMENTOS DO DOM
        // ===========================================
        const views = {
            login: document.getElementById('login-view'),
            register: document.getElementById('register-view'),
            admin: document.getElementById('admin-panel')
        };

        // ===========================================
        // UTILITÁRIOS DE TEXTO E MÁSCARAS
        // ===========================================
        
        /**
         * Normaliza texto: Remove acentos, converte para maiúsculas, remove espaços múltiplos
         * @param {string} text - Texto a ser normalizado
         * @returns {string} - Texto normalizado
         */
        const normalizeText = (text) => {
            if (!text) return "";
            return text.toString()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "") // Remove acentos
                .toUpperCase()
                .replace(/\s+/g, ' ') // Substitui múltiplos espaços por um
                .trim();
        };

        /**
         * Aplica máscara de CPF (000.000.000-00)
         */
        const maskCPF = (v) => {
            v = v.replace(/\D/g, "").slice(0, 11);
            return v.replace(/(\d{3})(\d)/, "$1.$2")
                    .replace(/(\d{3})(\d)/, "$1.$2")
                    .replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        };

        /**
         * Aplica máscara de telefone ((98) 98765-4321)
         */
        const maskPhone = (v) => {
             v = v.replace(/\D/g, "").slice(0, 11);
             if (v.length > 10) {
                 return v.replace(/^(\d\d)(\d{5})(\d{4}).*/, "($1) $2-$3");
             }
             return v.replace(/^(\d\d)(\d{4})(\d{0,4}).*/, "($1) $2-$3");
        };

        /**
         * Aplica máscara de CEP (00000-000)
         */
        const maskCEP = (v) => {
            v = v.replace(/\D/g, "").slice(0, 8);
            return v.replace(/^(\d{5})(\d)/, "$1-$2");
        };

        /**
         * Calcula idade baseado na data de nascimento
         */
        const calculateAge = (birthDate) => {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            
            return age;
        };

        /**
         * Gera link do WhatsApp
         */
        const getWhatsappLink = (phone) => {
            if (!phone) return '#';
            let num = phone.replace(/\D/g, '');
            if (num.length < 10) return '#';
            if (!num.startsWith('55')) num = '55' + num;
            return `https://wa.me/${num}`;
        };

        /**
         * Formata data para exibição (DD/MM/AAAA)
         */
        const formatDate = (isoString) => {
            if (!isoString) return '';
            const date = new Date(isoString);
            return date.toLocaleDateString('pt-BR');
        };

        /**
         * Debounce function para otimizar eventos
         */
        const debounce = (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        };

        // ===========================================
        // NAVEGAÇÃO E GERENCIAMENTO DE VIEWS
        // ===========================================
        
        /**
         * Mostra uma view específica e esconde as outras
         */
        const showView = async (viewName) => {
            Object.values(views).forEach(el => el.classList.add('hidden-section'));
            views[viewName].classList.remove('hidden-section');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            if (viewName === 'register') {
                if (!auth.currentUser) {
                    signInAnonymously(auth).catch(err => console.warn("Erro ao fazer login anônimo:", err));
                }
                initRegisterForm();
            }
            
            // Reinicializa ícones Lucide
            if (window.lucide) lucide.createIcons();
        };

        // ===========================================
        // TABS DO PAINEL ADMIN
        // ===========================================
        const adminTabs = document.querySelectorAll('.nav-tab');
        const adminTabContents = document.querySelectorAll('.admin-tab-content');
        
        adminTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                adminTabs.forEach(t => t.classList.remove('active'));
                adminTabContents.forEach(c => c.classList.add('hidden-section'));
                
                tab.classList.add('active');
                document.getElementById(`tab-${tab.dataset.tab}`).classList.remove('hidden-section');
                
                if (window.lucide) lucide.createIcons();
            });
        });

        // ===========================================
        // AUTENTICAÇÃO
        // ===========================================
        
        /**
         * Observa mudanças no estado de autenticação
         */
        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.uid === ADMIN_UID) {
                    showView('admin');
                    initAdminPanel();
                } else if (!user.isAnonymous) {
                    signOut(auth);
                    showView('login');
                } else {
                    // Usuário anônimo, mantém na view atual se for registro
                    if (document.getElementById('register-view').classList.contains('hidden-section')) {
                        showView('login');
                    }
                }
            } else {
                showView('login');
            }
        });

        /**
         * Form de Login do Admin
         */
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value.trim();
            const pass = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('auth-error');
            
            errorEl.textContent = '';
            errorEl.classList.add('hidden-section');
            
            try {
                await setPersistence(auth, browserLocalPersistence);
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (e) {
                console.error("Erro de autenticação:", e);
                errorEl.textContent = 'Email ou senha incorretos. Verifique os dados e tente novamente.';
                errorEl.classList.remove('hidden-section');
            }
        });

        /**
         * Botão de Logout
         */
        document.getElementById('admin-logout-btn').addEventListener('click', () => {
            if (confirm('Deseja realmente sair do painel administrativo?')) {
                signOut(auth).then(() => {
                    window.location.reload();
                }).catch(err => {
                    console.error("Erro ao fazer logout:", err);
                    alert('Erro ao sair. Tente novamente.');
                });
            }
        });

        /**
         * Botões de Navegação
         */
        document.getElementById('go-to-register-btn').addEventListener('click', () => showView('register'));
        document.getElementById('back-to-login-btn').addEventListener('click', () => {
             if (auth.currentUser?.isAnonymous) {
                 signOut(auth);
             }
             showView('login');
        });

        // ===========================================
        // BUSCA DE ENDEREÇO VIA CEP (ViaCEP API)
        // ===========================================
        
        /**
         * Busca endereço pelo CEP usando ViaCEP
         */
        async function fetchAddress(cep) {
            try {
                const cleanCep = cep.replace(/\D/g, '');
                if (cleanCep.length !== 8) return;
                
                const res = await fetch(`https://viacep.com.br/ws/${cleanCep}/json/`);
                const data = await res.json();
                
                if (!data.erro) {
                    const enderecoEl = document.getElementById('endereco');
                                        const enderecoEl = document.getElementById('endereco');
                    const bairroEl = document.getElementById('bairro');
                    const cidadeEl = document.getElementById('cidade');
                    const ufEl = document.getElementById('uf');
                    
                    if (enderecoEl && data.logradouro) {
                        enderecoEl.value = data.logradouro;
                    }
                    if (bairroEl && data.bairro) {
                        bairroEl.value = data.bairro;
                    }
                    if (cidadeEl && data.localidade) {
                        cidadeEl.value = data.localidade;
                    }
                    if (ufEl && data.uf) {
                        ufEl.value = data.uf;
                    }
                }
            } catch (err) {
                console.warn('Erro ao buscar CEP:', err);
            }
        }

        // ===========================================
        // FORMULÁRIO DE CADASTRO (PÚBLICO)
        // ===========================================
        
        let allParticipants = [];
        let registrationListeners = [];
        
        /**
         * Inicializa formulário de cadastro
         */
        function initRegisterForm() {
            // Define data de hoje
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = today;
            
            // Define data máxima de nascimento (hoje)
            const birthDateInput = document.getElementById('dataNascimento');
            if (birthDateInput) {
                birthDateInput.max = today;
            }
            
            // Limpa formulário
            document.getElementById('register-form').reset();
            document.getElementById('editing-id').value = '';
            document.getElementById('inscricao').value = 'Automático';
            
            // Carrega configuração de polos
            loadPolosConfig();
            
            // Gera perguntas de saúde
            generateHealthQuestions();
            
            // Event Listeners
            setupFormListeners();
        }
        
        /**
         * Carrega configuração de polos do Firebase
         */
        async function loadPolosConfig() {
            try {
                const settingsDoc = await getDoc(doc(db, SETTINGS_COLLECTION, 'general'));
                const polosContainer = document.getElementById('polo-container');
                
                if (settingsDoc.exists() && settingsDoc.data().polos && settingsDoc.data().polos.length > 0) {
                    const polos = settingsDoc.data().polos;
                    
                    const select = document.createElement('select');
                    select.id = 'polo';
                    select.className = 'form-select';
                    select.required = true;
                    
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Selecione seu Polo...';
                    select.appendChild(defaultOption);
                    
                    polos.forEach(polo => {
                        const option = document.createElement('option');
                        option.value = polo;
                        option.textContent = polo;
                        select.appendChild(option);
                    });
                    
                    polosContainer.innerHTML = `
                        <label for="polo" class="form-label">
                            Qual é o seu Polo? <span class="text-red-500">*</span>
                        </label>
                    `;
                    polosContainer.appendChild(select);
                } else {
                    // Mantém input text se não houver configuração
                    polosContainer.innerHTML = `
                        <label for="polo" class="form-label">
                            Qual é o seu Polo? <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="polo" class="form-input" placeholder="Ex: CENTRO, ZONA NORTE..." required>
                    `;
                }
            } catch (err) {
                console.warn('Erro ao carregar polos:', err);
            }
        }
        
        /**
         * Gera perguntas de saúde dinamicamente
         */
        function generateHealthQuestions() {
            const questions = [
                { id: 'hipertenso', label: 'Hipertenso?' },
                { id: 'diabetico', label: 'Diabético?' },
                { id: 'cardiaco', label: 'Cardíaco?' },
                { id: 'respiratorio', label: 'Problema Respiratório?' },
                { id: 'renal', label: 'Problema Renal?' },
                { id: 'hepatico', label: 'Problema Hepático?' }
            ];
            
            const container = document.getElementById('health-questions-container');
            const template = document.getElementById('health-question-template');
            
            container.innerHTML = '';
            
            questions.forEach(q => {
                const clone = template.content.cloneNode(true);
                const label = clone.querySelector('label');
                const select = clone.querySelector('select');
                
                label.textContent = q.label;
                select.id = q.id;
                select.name = q.id;
                
                container.appendChild(clone);
            });
        }
        
        /**
         * Configura todos os listeners do formulário
         */
        function setupFormListeners() {
            // Máscaras com debounce
            const cpfInput = document.getElementById('cpf');
            const phoneInput = document.getElementById('telefone');
            const cepInput = document.getElementById('cep');
            
            if (cpfInput) {
                cpfInput.addEventListener('input', debounce((e) => {
                    e.target.value = maskCPF(e.target.value);
                }, 100));
            }
            
            if (phoneInput) {
                phoneInput.addEventListener('input', debounce((e) => {
                    e.target.value = maskPhone(e.target.value);
                }, 100));
            }
            
            if (cepInput) {
                cepInput.addEventListener('input', debounce((e) => {
                    e.target.value = maskCEP(e.target.value);
                }, 100));
                
                cepInput.addEventListener('blur', (e) => {
                    const cep = e.target.value.replace(/\D/g, '');
                    if (cep.length === 8) {
                        fetchAddress(cep);
                    }
                });
            }
            
            // Cálculo automático de idade
            const birthInput = document.getElementById('dataNascimento');
            const ageInput = document.getElementById('idade');
            
            if (birthInput && ageInput) {
                birthInput.addEventListener('change', (e) => {
                    if (e.target.value) {
                        ageInput.value = calculateAge(e.target.value);
                    } else {
                        ageInput.value = '';
                    }
                });
            }
            
            // Handler do campo "Outro" para camisa
            const camisaRadios = document.querySelectorAll('input[name="camisa"]');
            const camisaOutroInput = document.getElementById('camisaOutro');
            
            camisaRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'Outro') {
                        camisaOutroInput.focus();
                    }
                });
            });
        }
        
        /**
         * Submissão do formulário de cadastro
         */
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-register-btn');
            const submitText = document.getElementById('submit-text');
            const submitLoading = document.getElementById('submit-loading');
            const messageEl = document.getElementById('register-message');
            
            // Desabilita botão
            submitBtn.disabled = true;
            submitText.classList.add('hidden-section');
            submitLoading.classList.remove('hidden-section');
            messageEl.textContent = '';
            
            try {
                // Coleta dados do formulário
                const formData = {
                    polo: normalizeText(document.getElementById('polo').value),
                    data: document.getElementById('data').value,
                    nome: normalizeText(document.getElementById('nome').value),
                    sexo: document.querySelector('input[name="sexo"]:checked')?.value || '',
                    dataNascimento: document.getElementById('dataNascimento').value,
                    idade: parseInt(document.getElementById('idade').value) || 0,
                    telefone: document.getElementById('telefone').value.trim(),
                    cep: document.getElementById('cep').value.trim(),
                    endereco: normalizeText(document.getElementById('endereco').value),
                    numero: document.getElementById('numero').value.trim(),
                    bairro: normalizeText(document.getElementById('bairro').value),
                    cidade: normalizeText(document.getElementById('cidade').value),
                    uf: document.getElementById('uf').value.toUpperCase(),
                    cpf: document.getElementById('cpf').value.trim(),
                    rg: document.getElementById('rg').value.trim(),
                    profissao: normalizeText(document.getElementById('profissao').value),
                    estadoCivil: document.getElementById('estadoCivil').value,
                    casaPropria: document.getElementById('casaPropria').value,
                    zona: document.getElementById('zona').value.trim(),
                    tipoSanguineo: document.getElementById('tipoSanguineo').value.toUpperCase().trim(),
                    
                    // Saúde
                    hipertenso: document.getElementById('hipertenso').value,
                    diabetico: document.getElementById('diabetico').value,
                    cardiaco: document.getElementById('cardiaco').value,
                    respiratorio: document.getElementById('respiratorio')?.value || 'Não',
                    renal: document.getElementById('renal')?.value || 'Não',
                    hepatico: document.getElementById('hepatico')?.value || 'Não',
                    
                    alergias: document.getElementById('alergias').value,
                    alergiasQual: normalizeText(document.getElementById('alergiasQual').value),
                    cirurgiaRecente: document.getElementById('cirurgiaRecente').value,
                    cirurgiaRecenteQual: normalizeText(document.getElementById('cirurgiaRecenteQual').value),
                    tratamentoMedico: document.getElementById('tratamentoMedico').value,
                    tratamentoMedicoQual: normalizeText(document.getElementById('tratamentoMedicoQual').value),
                    tomaMedicamento: document.getElementById('tomaMedicamento').value,
                    tomaMedicamentoQual: normalizeText(document.getElementById('tomaMedicamentoQual').value),
                    problemaOrtopedico: document.getElementById('problemaOrtopedico').value,
                    problemaOrtopedicoQual: normalizeText(document.getElementById('problemaOrtopedicoQual').value),
                    
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Camisa
                const camisaSelected = document.querySelector('input[name="camisa"]:checked');
                if (camisaSelected) {
                    if (camisaSelected.value === 'Outro') {
                        formData.camisa = normalizeText(document.getElementById('camisaOutro').value);
                    } else {
                        formData.camisa = camisaSelected.value;
                    }
                }
                
                // Validações básicas
                if (!formData.polo || !formData.nome || !formData.cpf) {
                    throw new Error('Preencha todos os campos obrigatórios (Nome, CPF e Polo)');
                }
                
                // Verifica se é edição ou novo cadastro
                const editingId = document.getElementById('editing-id').value;
                
                if (editingId) {
                    // Atualização
                    const docRef = doc(db, INSCRICOES_COLLECTION, editingId);
                    await updateDoc(docRef, formData);
                    
                    messageEl.className = 'mt-4 text-center text-lg font-bold text-green-600';
                    messageEl.textContent = '✅ Cadastro atualizado com sucesso!';
                } else {
                    // Novo cadastro - gera número de inscrição
                    const count = await getCountFromServer(collection(db, INSCRICOES_COLLECTION));
                    formData.inscricao = (count.data().count + 1).toString().padStart(4, '0');
                    
                    await addDoc(collection(db, INSCRICOES_COLLECTION), formData);
                    
                    messageEl.className = 'mt-4 text-center text-lg font-bold text-green-600';
                    messageEl.innerHTML = `
                        ✅ Inscrição realizada com sucesso!<br>
                        <span class="text-pink-600">Nº ${formData.inscricao}</span><br>
                        <span class="text-sm text-gray-600">Aguarde aprovação do administrador</span>
                    `;
                    
                    // Limpa formulário após 3 segundos
                    setTimeout(() => {
                        document.getElementById('register-form').reset();
                        initRegisterForm();
                        messageEl.textContent = '';
                    }, 5000);
                }
                
            } catch (err) {
                console.error('Erro ao salvar:', err);
                messageEl.className = 'mt-4 text-center text-lg font-bold text-red-600';
                messageEl.textContent = '❌ ' + (err.message || 'Erro ao salvar. Tente novamente.');
            } finally {
                submitBtn.disabled = false;
                submitText.classList.remove('hidden-section');
                submitLoading.classList.add('hidden-section');
            }
        });

        // ===========================================
        // PAINEL ADMINISTRATIVO
        // ===========================================
        
        /**
         * Inicializa o painel administrativo
         */
        function initAdminPanel() {
            loadAllParticipants();
            setupAdminListeners();
            loadSettingsConfig();
        }
        
        /**
         * Carrega todos os participantes em tempo real
         */
        function loadAllParticipants() {
            // Limpa listeners anteriores
            registrationListeners.forEach(unsub => unsub());
            registrationListeners = [];
            
            const unsubscribe = onSnapshot(
                collection(db, INSCRICOES_COLLECTION),
                (snapshot) => {
                    allParticipants = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    updateDashboardStats();
                    updatePendingList();
                    updateParticipantsTable();
                    updateReportPoloFilter();
                },
                (error) => {
                    console.error('Erro ao carregar participantes:', error);
                    alert('Erro ao carregar dados. Verifique sua conexão.');
                }
            );
            
            registrationListeners.push(unsubscribe);
        }
        
        /**
         * Atualiza cards de estatísticas no dashboard
         */
        function updateDashboardStats() {
            const total = allParticipants.length;
            const approved = allParticipants.filter(p => p.status === 'approved').length;
            const pending = allParticipants.filter(p => p.status === 'pending').length;
            
            const statsContainer = document.getElementById('admin-stats');
            statsContainer.innerHTML = `
                <div class="card p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase">Total Inscrições</p>
                            <p class="text-3xl font-bold text-gray-800">${total}</p>
                        </div>
                        <i data-lucide="users" class="w-12 h-12 text-blue-500 opacity-20"></i>
                    </div>
                </div>
                
                <div class="card p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase">Aprovados</p>
                            <p class="text-3xl font-bold text-green-600">${approved}</p>
                        </div>
                        <i data-lucide="check-circle" class="w-12 h-12 text-green-500 opacity-20"></i>
                    </div>
                </div>
                
                <div class="card p-6 border-l-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase">Pendentes</p>
                            <p class="text-3xl font-bold text-yellow-600">${pending}</p>
                        </div>
                        <i data-lucide="clock" class="w-12 h-12 text-yellow-500 opacity-20"></i>
                    </div>
                </div>
                
                <div class="card p-6 border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase">Polos Ativos</p>
                            <p class="text-3xl font-bold text-purple-600">${[...new Set(allParticipants.map(p => p.polo))].length}</p>
                        </div>
                        <i data-lucide="map-pin" class="w-12 h-12 text-purple-500 opacity-20"></i>
                    </div>
                </div>
            `;
            
            if (window.lucide) lucide.createIcons();
        }
        
        /**
         * Atualiza lista de inscrições pendentes
         */
        function updatePendingList() {
            const pending = allParticipants.filter(p => p.status === 'pending')
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            const container = document.getElementById('pending-registrations-list');
            const badge = document.getElementById('pending-count-badge');
            const noMessage = document.getElementById('no-pending-message');
            
            badge.textContent = pending.length;
            
            if (pending.length === 0) {
                container.innerHTML = '';
                noMessage.classList.remove('hidden-section');
                return;
            }
            
            noMessage.classList.add('hidden-section');
            
            container.innerHTML = pending.map(p => `
                <div class="card p-4 hover:shadow-md transition-shadow border-l-4 border-yellow-400">
                    <div class="flex flex-col md:flex-row justify-between gap-4">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg text-gray-800">${p.nome || 'Sem nome'}</h3>
                            <div class="grid grid-cols-2 gap-2 mt-2 text-sm text-gray-600">
                                <p><span class="font-semibold">CPF:</span> ${p.cpf || 'N/A'}</p>
                                <p><span class="font-semibold">Polo:</span> ${p.polo || 'N/A'}</p>
                                <p><span class="font-semibold">Telefone:</span> ${p.telefone || 'N/A'}</p>
                                <p><span class="font-semibold">Data:</span> ${formatDate(p.createdAt)}</p>
                            </div>
                        </div>
                        <div class="flex flex-col md:flex-row gap-2 items-end md:items-center">
                            <button 
                                onclick="window.approveParticipant('${p.id}')" 
                                class="btn btn-success text-sm px-4 py-2"
                            >
                                <i data-lucide="check" class="w-4 h-4 mr-1"></i> Aprovar
                            </button>
                            <button 
                                onclick="window.viewDetails('${p.id}')" 
                                class="btn btn-secondary text-sm px-4 py-2"
                            >
                                <i data-lucide="eye" class="w-4 h-4 mr-1"></i> Ver Detalhes
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (window.lucide) lucide.createIcons();
        }
        
        /**
         * Atualiza tabela de participantes
         */
        function updateParticipantsTable() {
            const searchTerm = normalizeText(document.getElementById('admin-search').value);
            const sortBy = document.getElementById('admin-sort').value;
            
            let filtered = [...allParticipants];
            
            // Filtro de busca
            if (searchTerm) {
                filtered = filtered.filter(p => {
                    const nome = normalizeText(p.nome || '');
                    const cpf = p.cpf || '';
                    const polo = normalizeText(p.polo || '');
                    
                    return nome.includes(searchTerm) || 
                           cpf.includes(searchTerm) || 
                           polo.includes(searchTerm);
                });
            }
            
            // Ordenação
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'name_asc':
                        return (a.nome || '').localeCompare(b.nome || '');
                    case 'polo_asc':
                        return (a.polo || '').localeCompare(b.polo || '');
                    case 'date_desc':
                    default:
                        return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
                }
            });
            
            const tbody = document.getElementById('all-participants-table-body');
            const noMessage = document.getElementById('no-participants-message');
            const footerCount = document.getElementById('table-footer-count');
            
            if (filtered.length === 0) {
                tbody.innerHTML = '';
                noMessage.classList.remove('hidden-section');
                footerCount.textContent = 'Nenhum registro encontrado';
                return;
            }
            
            noMessage.classList.add('hidden-section');
            footerCount.textContent = `${filtered.length} registro${filtered.length !== 1 ? 's' : ''} encontrado${filtered.length !== 1 ? 's' : ''}`;
            
            tbody.innerHTML = filtered.map(p => {
                const statusConfig = {
                    approved: { class: 'badge-success', text: 'Aprovado' },
                    pending: { class: 'badge-warning', text: 'Pendente' },
                    rejected: { class: 'badge-danger', text: 'Rejeitado' }
                };
                
                const status = statusConfig[p.status] || statusConfig.pending;
                
                return `
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4">
                            <div class="font-mono text-xs text-gray-500 mb-1">#${p.inscricao || 'N/A'}</div>
                            <div class="font-semibold text-gray-800">${p.nome || 'Sem nome'}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-800">
                                ${p.polo || 'N/A'}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm text-gray-800">${p.telefone || 'N/A'}</div>
                            <div class="text-xs text-gray-500 font-mono">${p.cpf || 'N/A'}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="font-bold text-pink-600 text-lg">${p.camisa || 'N/A'}</span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="badge ${status.class}">${status.text}</span>
                        </td>
                        <td class="px-6 py-4 text-right space-x-2">
                            <button 
                                onclick="window.viewDetails('${p.id}')" 
                                class="btn btn-secondary text-xs py-1 px-3"
                                title="Ver/Editar"
                            >
                                <i data-lucide="edit" class="w-3 h-3"></i>
                            </button>
                            ${p.telefone ? `
                                <a 
                                    href="${getWhatsappLink(p.telefone)}" 
                                    target="_blank"
                                    class="btn btn-whatsapp text-xs py-1 px-3 inline-flex"
                                    title="WhatsApp"
                                >
                                    <i data-lucide="message-circle" class="w-3 h-3"></i>
                                </a>
                            ` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
            
            if (window.lucide) lucide.createIcons();
        }
        
        /**
         * Configura listeners do painel admin
         */
        function setupAdminListeners() {
            // Busca e ordenação
            const searchInput = document.getElementById('admin-search');
            const sortSelect = document.getElementById('admin-sort');
            
            if (searchInput) {
                searchInput.addEventListener('input', debounce(() => {
                    updateParticipantsTable();
                }, 300));
            }
            
            if (sortSelect) {
                sortSelect.addEventListener('change', updateParticipantsTable);
            }
            
            // Botão de refresh
            const refreshBtn = document.getElementById('refresh-data-btn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    loadAllParticipants();
                    refreshBtn.innerHTML = '<i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i>';
                    setTimeout(() => {
                        refreshBtn.innerHTML = '<i data-lucide="refresh-cw" class="w-3 h-3"></i>';
                        if (window.lucide) lucide.createIcons();
                    }, 1000);
                });
            }
            
            // Relatórios
            document.getElementById('generate-report-btn')?.addEventListener('click', generateReport);
            document.getElementById('clear-filters-btn')?.addEventListener('click', clearReportFilters);
            document.getElementById('export-csv-btn')?.addEventListener('click', () => exportData('csv'));
            document.getElementById('export-xlsx-btn')?.addEventListener('click', () => exportData('xlsx'));
            document.getElementById('export-pdf-btn')?.addEventListener('click', () => exportData('pdf'));
            
            // Configurações
            document.getElementById('save-settings-btn')?.addEventListener('click', saveSettingsConfig);
            document.getElementById('renumber-all-btn')?.addEventListener('click', renumberAllRegistrations);
        }
        
        /**
         * Atualiza filtro de polos nos relatórios
         */
        function updateReportPoloFilter() {
            const polos = [...new Set(allParticipants.map(p => p.polo))].filter(Boolean).sort();
            const select = document.getElementById('report-polo-filter');
            
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '<option value="all">Todos os Polos</option>';
            
            polos.forEach(polo => {
                const option = document.createElement('option');
                option.value = polo;
                option.textContent = polo;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        }
        
        // ===========================================
        // MODAL DE EDIÇÃO
        // ===========================================
        
        const modal = document.getElementById('details-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalSaveBtn = document.getElementById('modal-save-btn');
        const modalDeleteBtn = document.getElementById('modal-delete-btn');
        
        /**
         * Abre modal com detalhes do participante
         */
        window.viewDetails = async (docId) => {
            try {
                const docSnap = await getDoc(doc(db, INSCRICOES_COLLECTION, docId));
                
                if (!docSnap.exists()) {
                    alert('Registro não encontrado');
                    return;
                }
                
                const data = docSnap.data();
                
                // Preenche campos do modal
                document.getElementById('edit-doc-id').value = docId;
                document.getElementById('edit-status').value = data.status || 'pending';
                document.getElementById('edit-inscricao').value = data.inscricao || 'N/A';
                document.getElementById('edit-createdAtDisplay').value = formatDate(data.createdAt) || '';
                
                document.getElementById('edit-nome').value = data.nome || '';
                document.getElementById('edit-cpf').value = data.cpf || '';
                document.getElementById('edit-rg').value = data.rg || '';
                document.getElementById('edit-dataNascimento').value = data.dataNascimento || '';
                document.getElementById('edit-idade').value = data.idade || '';
                document.getElementById('edit-sexo').value = data.sexo || '';
                document.getElementById('edit-camisa').value = data.camisa || '';
                document.getElementById('edit-telefone').value = data.telefone || '';
                
                document.getElementById('edit-polo').value = data.polo || '';
                document.getElementById('edit-cep').value = data.cep || '';
                document.getElementById('edit-endereco').value = data.endereco || '';
                document.getElementById('edit-numero').value = data.numero || '';
                document.getElementById('edit-bairro').value = data.bairro || '';
                document.getElementById('edit-cidade').value = data.cidade || '';
                
                document.getElementById('edit-profissao').value = data.profissao || '';
                document.getElementById('edit-estadoCivil').value = data.estadoCivil || '';
                document.getElementById('edit-zona').value = data.zona || '';
                document.getElementById('edit-tipoSanguineo').value = data.tipoSanguineo || '';
                
                // Checkboxes de saúde
                document.getElementById('edit-check-hipertenso').checked = data.hipertenso === 'Sim';
                document.getElementById('edit-check-diabetico').checked = data.diabetico === 'Sim';
                document.getElementById('edit-check-cardiaco').checked = data.cardiaco === 'Sim';
                
                // Observações de saúde (concatenadas)
                const obsArray = [];
                if (data.alergiasQual) obsArray.push(`Alergias: ${data.alergiasQual}`);
                if (data.cirurgiaRecenteQual) obsArray.push(`Cirurgia: ${data.cirurgiaRecenteQual}`);
                if (data.tratamentoMedicoQual) obsArray.push(`Tratamento: ${data.tratamentoMedicoQual}`);
                if (data.tomaMedicamentoQual) obsArray.push(`Medicamentos: ${data.tomaMedicamentoQual}`);
                if (data.problemaOrtopedicoQual) obsArray.push(`Ortopédico: ${data.problemaOrtopedicoQual}`);
                
                document.getElementById('edit-obs-saude').value = obsArray.join('\n');
                
                // Listener de idade ao mudar data de nascimento
                const editBirthInput = document.getElementById('edit-dataNascimento');
                editBirthInput.addEventListener('change', (e) => {
                    if (e.target.value) {
                        document.getElementById('edit-idade').value = calculateAge(e.target.value);
                    }
                });
                
                // Mostra modal
                modal.classList.add('active');
                if (window.lucide) lucide.createIcons();
                
            } catch (err) {
                console.error('Erro ao carregar detalhes:', err);
                alert('Erro ao carregar dados. Tente novamente.');
            }
        };
        
        /**
         * Fecha modal
         */
        function closeModal() {
            modal.classList.remove('active');
        }
        
        closeModalBtn.addEventListener('click', closeModal);
        modalCancelBtn.addEventListener('click', closeModal);
        
        // Fecha modal ao clicar fora
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        // Fecha modal com ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeModal();
            }
        });
        
        /**
         * Salva alterações do modal
         */
        modalSaveBtn.addEventListener('click', async () => {
            const docId = document.getElementById('edit-doc-id').value;
            
            if (!docId) return;
            
            try {
                modalSaveBtn.disabled = true;
                modalSaveBtn.innerHTML = '<div class="loading-spinner mr-2"></div> Salvando...';
                
                const updatedData = {
                    status: document.getElementById('edit-status').value,
                    nome: normalizeText(document.getElementById('edit-nome').value),
                    cpf: document.getElementById('edit-cpf').value.trim(),
                    rg: document.getElementById('edit-rg').value.trim(),
                    dataNascimento: document.getElementById('edit-dataNascimento').value,
                    idade: parseInt(document.getElementById('edit-idade').value) || 0,
                    sexo: document.getElementById('edit-sexo').value,
                    camisa: document.getElementById('edit-camisa').value.toUpperCase(),
                    telefone: document.getElementById('edit-telefone').value.trim(),
                    
                    polo: normalizeText(document.getElementById('edit-polo').value),
                    cep: document.getElementById('edit-cep').value.trim(),
                    endereco: normalizeText(document.getElementById('edit-endereco').value),
                    numero: document.getElementById('edit-numero').value.trim(),
                    bairro: normalizeText(document.getElementById('edit-bairro').value),
                    cidade: normalizeText(document.getElementById('edit-cidade').value),
                    
                    profissao: normalizeText(document.getElementById('edit-profissao').value),
                    estadoCivil: document.getElementById('edit-estadoCivil').value,
                    zona: document.getElementById('edit-zona').value.trim(),
                    tipoSanguineo: document.getElementById('edit-tipoSanguineo').value.toUpperCase().trim(),
                    
                    hipertenso: document.getElementById('edit-check-hipertenso').checked ? 'Sim' : 'Não',
                    diabetico: document.getElementById('edit-check-diabetico').checked ? 'Sim' : 'Não',
                    cardiaco: document.getElementById('edit-check-cardiaco').checked ? 'Sim' : 'Não',
                    
                    updatedAt: new Date().toISOString()
                };
                
                await updateDoc(doc(db, INSCRICOES_COLLECTION, docId), updatedData);
                
                alert('✅ Dados salvos com sucesso!');
                closeModal();
                
            } catch (err) {
                console.error('Erro ao salvar:', err);
                alert('Erro ao salvar alterações. Tente novamente.');
            } finally {
                modalSaveBtn.disabled = false;
                modalSaveBtn.innerHTML = '<i data-lucide="save" class="w-4 h-4 mr-2"></i> SALVAR ALTERAÇÕES';
                if (window.lucide) lucide.createIcons();
            }
        });
        
        /**
         * Deleta registro
         */
        modalDeleteBtn.addEventListener('click', async () => {
            const docId = document.getElementById('edit-doc-id').value;
            const nome = document.getElementById('edit-nome').value;
            
            if (!docId) return;
            
            if (!confirm(`⚠️ ATENÇÃO!\n\nDeseja realmente EXCLUIR PERMANENTEMENTE o cadastro de:\n\n${nome}\n\nEsta ação NÃO pode ser desfeita!`)) {
                return;
            }
            
            try {
                await deleteDoc(doc(db, INSCRICOES_COLLECTION, docId));
                alert('✅ Cadastro excluído com sucesso.');
                closeModal();
            } catch (err) {
                console.error('Erro ao excluir:', err);
                alert('Erro ao excluir cadastro. Tente novamente.');
            }
        });
        
        /**
         * Aprova participante direto (atalho)
         */
        window.approveParticipant = async (docId) => {
            try {
                await updateDoc(doc(db, INSCRICOES_COLLECTION, docId), {
                    status: 'approved',
                    updatedAt: new Date().toISOString()
                });
                
                // Feedback visual temporário
                const btn = event.target.closest('button');
                if (btn) {
                    btn.innerHTML = '✅ Aprovado!';
                    btn.disabled = true;
                    setTimeout(() => loadAllParticipants(), 500);
                }
            } catch (err) {
                console.error('Erro ao aprovar:', err);
                alert('Erro ao aprovar. Tente novamente.');
            }
        };
        
        // ===========================================
        // RELATÓRIOS E EXPORTAÇÃO
        // ===========================================
        
        /**
         * Gera relatório com filtros
         */
        function generateReport() {
            const filters = {
                status: document.getElementById('report-status-filter').value,
                polo: document.getElementById('report-polo-filter').value,
                camisa: document.getElementById('report-camisa-filter').value,
                sexo: document.getElementById('report-sexo-filter').value,
                cidade: normalizeText(document.getElementById('report-city-filter').value),
                ageMin: parseInt(document.getElementById('report-age-min').value) || 0,
                ageMax: parseInt(document.getElementById('report-age-max').value) || 999
            };
            
            let filtered = [...allParticipants];
            
            // Aplica filtros
            if (filters.status !== 'all') {
                filtered = filtered.filter(p => p.status === filters.status);
            }
            
            if (filters.polo !== 'all') {
                filtered = filtered.filter(p => normalizeText(p.polo) === normalizeText(filters.polo));
            }
            
            if (filters.camisa !== 'all') {
                filtered = filtered.filter(p => p.camisa === filters.camisa);
            }
            
            if (filters.sexo !== 'all') {
                filtered = filtered.filter(p => p.sexo === filters.sexo);
            }
            
            if (filters.cidade) {
                filtered = filtered.filter(p => normalizeText(p.cidade).includes(filters.cidade));
            }
            
            filtered = filtered.filter(p => {
                const idade = p.idade || 0;
                return idade >= filters.ageMin && idade <= filters.ageMax;
            });
            
            // Mostra resultados
            displayReportResults(filtered);
        }
        
        /**
         * Exibe resultados do relatório
         */
        function displayReportResults(data) {
            const container = document.getElementById('report-results-container');
            container.classList.remove('hidden-section');
            
            // Atualiza resumo
            document.getElementById('summary-total').textContent = data.length;
            
            // Resumo de camisas
            const camisas = {};
            data.forEach(p => {
                const size = p.camisa || 'N/A';
                camisas[size] = (camisas[size] || 0) + 1;
            });
            
            const camisasHTML = Object.entries(camisas)
                .sort((a, b) => b[1] - a[1])
                .map(([size, count]) => `
                    <span class="px-3 py-1 bg-white border border-gray-300 rounded-full text-sm font-bold">
                        ${size}: <span class="text-pink-600">${count}</span>
                    </span>
                `).join('');
            
            document.getElementById('summary-camisas').innerHTML = camisasHTML;
            
            // Colunas selecionadas
            const selectedFields = Array.from(document.querySelectorAll('#report-fields input:checked'))
                .map(input => input.value);
            
            // Mapeamento de nomes de colunas
            const fieldLabels = {
                nome: 'Nome',
                polo: 'Polo',
                camisa: 'Camisa',
                telefone: 'Telefone',
                idade: 'Idade',
                bairro: 'Bairro',
                status: 'Status',
                cpf: 'CPF',
                inscricao: 'Nº Insc.',
                zona: 'Zona',
                hipertenso: 'Hipertenso',
                diabetico: 'Diabético'
            };
            
            // Gera cabeçalho da tabela
            const thead = document.getElementById('report-table-head');
            thead.innerHTML = `
                <tr>
                    ${selectedFields.map(field => `
                        <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">
                            ${fieldLabels[field] || field}
                        </th>
                    `).join('')}
                </tr>
            `;
            
            // Gera corpo da tabela
            const tbody = document.getElementById('report-table-body');
            tbody.innerHTML = data.map(p => `
                <tr class="hover:bg-gray-50">
                    ${selectedFields.map(field => {
                        let value = p[field] || '-';
                        
                        if (field === 'status') {
                            const statusMap = {
                                approved: '<span class="badge badge-success">Aprovado</span>',
                                pending: '<span class="badge badge-warning">Pendente</span>',
                                rejected: '<span class="badge badge-danger">Rejeitado</span>'
                            };
                            value = statusMap[value] || value;
                        }
                        
                        return `<td class="px-4 py-2">${value}</td>`;
                    }).join('')}
                </tr>
            `).join('');
            
            // Salva dados para exportação
            window.currentReportData = { data, fields: selectedFields };
            
            // Scroll suave até resultados
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        /**
         * Limpa filtros do relatório
         */
        function clearReportFilters() {
            document.getElementById('report-status-filter').value = 'approved';
            document.getElementById('report-polo-filter').value = 'all';
            document.getElementById('report-camisa-filter').value = 'all';
            document.getElementById('report-sexo-filter').value = 'all';
            document.getElementById('report-city-filter').value = '';
            document.getElementById('report-age-min').value = '';
            document.getElementById('report-age-max').value = '';
            
            document.getElementById('report-results-container').classList.add('hidden-section');
        }
        
        /**
         * Exporta dados
         */
        function exportData(format) {
            if (!window.currentReportData) {
                alert('Gere um relatório primeiro antes de exportar.');
                return;
            }
            
            const { data, fields } = window.currentReportData;
            
            if (data.length === 0) {
                alert('Nenhum dado para exportar.');
                return;
            }
            
            const fieldLabels = {
                nome: 'Nome',
                polo: 'Polo',
                camisa: 'Camisa',
                telefone: 'Telefone',
                idade: 'Idade',
                bairro: 'Bairro',
                status: 'Status',
                cpf: 'CPF',
                inscricao: 'Nº Insc.',
                zona: 'Zona',
                hipertenso: 'Hipertenso',
                diabetico: 'Diabético'
            };
            
            if (format === 'csv') {
                // Exporta CSV
                const headers = fields.map(f => fieldLabels[f] || f);
                const rows = data.map(p => fields.map(f => {
                    let val = p[f] || '';
                    if (typeof val === 'string' && val.includes(',')) {
                        val = `"${val}"`;
                    }
                    return val;
                }));
                
                const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
                
                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `relatorio_zumba_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
            } else if (format === 'xlsx') {
                // Exporta XLSX
                const ws_data = [
                    fields.map(f => fieldLabels[f] || f),
                    ...data.map(p => fields.map(f => p[f] || ''))
                ];
                
                const ws = XLSX.utils.aoa_to_sheet(ws_data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Relatório");
                
                XLSX.writeFile(wb, `relatorio_zumba_${new Date().toISOString().split('T')[0]}.xlsx`);
                
            } else if (format === 'pdf') {
                // Exporta PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4');
                
                doc.setFontSize(16);
                doc.text('Relatório Projeto Zumba', 14, 15);
                doc.setFontSize(10);
                doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 14, 22);
                doc.text(`Total de registros: ${data.length}`, 14, 28);
                
                const headers = [fields.map(f => fieldLabels[f] || f)];
                const rows = data.map(p => fields.map(f => p[f] || ''));
                
                doc.autoTable({
                    head: headers,
                    body: rows,
                    startY: 35,
                    styles: { fontSize: 8, cellPadding: 2 },
                    headStyles: { fillColor: [236, 72, 153], fontStyle: 'bold' }
                });
                
                doc.save(`relatorio_zumba_${new Date().toISOString().split('T')[0]}.pdf`);
            }
        }
        
        // ===========================================
        // CONFIGURAÇÕES
        // ===========================================
        
        /**
         * Carrega configurações salvas
         */
        async function loadSettingsConfig() {
            try {
                const settingsDoc = await getDoc(doc(db, SETTINGS_COLLECTION, 'general'));
                
                if (settingsDoc.exists() && settingsDoc.data().polos) {
                    document.getElementById('settings-polos').value = settingsDoc.data().polos.join(', ');
                }
            } catch (err) {
                console.warn('Erro ao carregar configurações:', err);
            }
        }
        
        /**
         * Salva configurações
         */
        async function saveSettingsConfig() {
            const polosText = document.getElementById('settings-polos').value.trim();
            
            if (!polosText) {
                alert('Digite ao menos um polo.');
                return;
            }
            
            try {
                const polosArray = polosText.split(',').map(p => normalizeText(p)).filter(Boolean);
                
                await setDoc(doc(db, SETTINGS_COLLECTION, 'general'), {
                    polos: polosArray,
                    updatedAt: new Date().toISOString()
                });
                
                alert(`✅ Lista de polos salva com sucesso!\n\n${polosArray.length} polo(s) configurado(s).`);
                
                // Recarrega formulário de cadastro se estiver aberto
                if (!views.register.classList.contains('hidden-section')) {
                    loadPolosConfig();
                }
            } catch (err) {
                console.error('Erro ao salvar configurações:', err);
                alert('Erro ao salvar. Tente novamente.');
            }
        }
        
        /**
         * Renumera todos os cadastros
         */
        async function renumberAllRegistrations() {
            if (!confirm('⚠️ ATENÇÃO!\n\nIsto irá RENUMERAR TODOS os cadastros sequencialmente.\n\nOs números de inscrição serão reordenados pela data de criação.\n\nDeseja continuar?')) {
                return;
            }
            
            const btn = document.getElementById('renumber-all-btn');
            const btnText = document.getElementById('renumber-text');
            const btnLoading = document.getElementById('renumber-loading');
            const statusEl = document.getElementById('renumber-status');
            
            try {
                btn.disabled = true;
                btnText.classList.add('hidden-section');
                btnLoading.classList.remove('hidden-section');
                statusEl.textContent = 'Processando...';
                statusEl.className = 'mt-3 text-xs font-bold text-center text-blue-600';
                
                // Ordena por data de criação
                const sorted = [...allParticipants].sort((a, b) => 
                    new Date(a.createdAt || 0) - new Date(b.createdAt || 0)
                );
                
                // Renumera
                const updatePromises = sorted.map((p, index) => {
                    const newNumber = (index + 1).toString().padStart(4, '0');
                    return updateDoc(doc(db, INSCRICOES_COLLECTION, p.id), {
                        inscricao: newNumber,
                        updatedAt: new Date().toISOString()
                    });
                });
                
                await Promise.all(updatePromises);
                
                statusEl.textContent = `✅ Sucesso! ${sorted.length} cadastros renumerados.`;
                statusEl.className = 'mt-3 text-xs font-bold text-center text-green-600';
                
                setTimeout(() => {
                    statusEl.textContent = '';
                }, 5000);
                
            } catch (err) {
                console.error('Erro ao renumerar:', err);
                statusEl.textContent = '❌ Erro ao renumerar. Tente novamente.';
                statusEl.className = 'mt-3 text-xs font-bold text-center text-red-600';
            } finally {
                btn.disabled = false;
                btnText.classList.remove('hidden-section');
                btnLoading.classList.add('hidden-section');
            }
        }
        
        // ===========================================
        // INICIALIZAÇÃO
        // ===========================================
        
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializa ícones Lucide
            if (window.lucide) {
                lucide.createIcons();
            }
            
            // View inicial já é gerenciada pelo onAuthStateChanged
        });
        
    </script>
</body>
</html>

